---
platform: linux
image_resource: { type: docker-image, source: { repository: quay.io/helmpack/chart-testing}}

inputs:
- name: repo

run:
  path: bash
  args:
  - -cx
  - |
    cd repo
    # for getting back all the branches
    git config remote.origin.fetch refs/heads/*:refs/remotes/origin/*
    git fetch --all
    export HELM_CONFIG_HOME=./
    ct lint --since $(git log origin/master..$(git rev-parse --abbrev-ref HEAD) --oneline | tail -1 | awk '{printf $1}') --debug

    # cd repo
    # git remote show origin
    # git branch -a | head -n 20
    # # unshallow the current branch
    # git fetch --unshallow

    # # for getting back all the branches (see Peter Cordes' comment)
    # git config remote.origin.fetch refs/heads/*:refs/remotes/origin/*
    # git fetch --unshallow
    # git fetch --all
    # git branch -a
    # cat .git/ref
    # git log | head -n 10
    # git rev-parse --abbrev-ref HEAD
    # # git checkout --force introduce-chart-testing
    # export HELM_CONFIG_HOME=./
    # ct lint --since $(git log origin/master..$(git rev-parse --abbrev-ref HEAD) --oneline | tail -1 | awk '{printf $1}') --debug
