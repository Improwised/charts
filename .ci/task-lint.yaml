---
platform: linux
image_resource: { type: docker-image, source: { repository: quay.io/helmpack/chart-testing}}

inputs:
- name: repo

run:
  path: bash
  args:
  - -cx
  - |
    cd repo
    git fetch --all
    git remote show origin && exit 0
    git remote add origin https://github.com/concourse/git-resource.git
    git fetch --all | head -n 100
    git log origin/master
    git remote show origin
    cat .git/ref
    git log | head -n 100
    git rev-parse --abbrev-ref HEAD
    # git checkout --force introduce-chart-testing
    export HELM_CONFIG_HOME=./
    ct lint --since $(git log origin/master..$(git rev-parse --abbrev-ref HEAD) --oneline | tail -1 | awk '{printf $1}') --debug
